<!DOCTYPE html>      
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주문/결제페이지</title>
    <link rel="stylesheet" href="/order/reset.css">
    <link rel="stylesheet" href="/order/common.css">
    <link rel="stylesheet" href="/order/order.css">
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="/order/common.js"></script>
    <script src="/order/order.js"></script>

</head>
<body>
    <div id="wrap">
        <div id="container">
            <div id="main">
                <div id="content">
                    <div class="user_form">
                        <h1 class="h1_tit">주문서</h1>

                        <h2 class="tit_section fst">
                            주문상품
                        </h2>

                        <div id="itemList" class="page_aticle order_goodslist">
                            <ul class="list_product" th:each=item:${productList}>
                                <li>
                                    <div class="thumb">
                                        <img src="https://img-cf.kurly.com/shop/data/goods/156757412839i0.jpg" alt="상품이미지">
                                    </div>

                                    <div class="name">
                                        <div class="inner_name" th:text="${item.key.name}"></div>
                                    </div>

                                    <div class="ea" th:text="${#numbers.formatInteger(item.value, 1, 'COMMA') + ' 개'}">
                                        
                                    </div>

                                    <div class="info_price">
                                        <span class="num">
                                            <span class="price" th:text="${#numbers.formatInteger((item.key.price * item.value), 1, 'COMMA') + ' 원'}">
                                                
                                            </span>
                                            
                                        </span>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <form action="">
                            <h2 class="tit_section" id="titFocusOrderer">주문자 정보</h2>

                            <div class="order_section data_orderer">
                                <table class="goodsinfo_table">
                                    <tbody>
                                        <tr class="fst">
                                            <th>보내는 분</th>
                                            <td>
                                                <span th:text="${SiteUser.name}"></span>
                                            </td>
                                        </tr>

                                        <tr class="fst">
                                            <th>휴대폰</th>
                                            <td>
                                                <span th:text="${SiteUser.tel}"></span>
                                            </td>
                                        </tr>

                                        <tr class="fst">
                                            <th>이메일</th>
                                            <td>
                                                <span th:text="${SiteUser.email}"></span>
                                                <p class="txt_guide">
                                                    <span class="txt txt_case1">이메일을 통해 주문처리과정을 보내드립니다.</span>
                                                    <span class="txt txt_case2">정보 변경은 <span class="txt_desc">마이컬리 &gt; 개인정보 수정</span> 메뉴에서 가능합니다.</span>
                                                </p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <h2 class="tit_section" id="divAddressWrapper">
                                배송지정보
                                
                            </h2>

                            <div class="order_section order_address" id="dataDelivery">
                                <div>
                                <br/>
	                                <h2 class="section_addr">
	                                    배송지 선택
	                                </h2>
                                </div>
                                <div class="section_full">
                                
                                	<input type="radio" name="address" value="default" class="radio" checked="checked"> 배송지 입력 | 
                                	<input type="radio" name="address" value="default" class="radio"th:each="adress:${SiteUser.adressList}" th:text="${adress.type}"> 
                                	<br/>
                                	<br/>
                                	<span class="tag" id="addrTags">
                                            <span style="display:block; margin-top:5px;">배송지 등록 및 수정은 마이페이지  > 배송지 관리에서 변경할 수 있어요</span>
                                    </span>
                                </div>
                                
                                
                                
                                <h3 class="section_addr">
                                    받는사람
                                </h3>
                                <div class="section_full">
                                    <span class="address" id="divDesination">
										<span class="address"><input type="text" class="adress_form_mini" id="name"></span>
                                    </span>
                                </div>
                                
                                <h3 class="section_addr">
                                    전화번호
                                </h3>
                                <div class="section_full">
                                    <span class="address" id="divDesination">
										<span class="address"><input type="text" class="adress_form_mini" id="tel"></span>
                                    </span>
                                </div>
                                
                                <h3 class="section_addr">
                                    배송지 주소
                                </h3>
                                <div class="section_full">
	                                <span class="address"><input type="text" class="adress_form_zip" id="postcode" placeholder="우편번호"/>
	                                <input type="button" class="adress_form_btn" value="주소 검색" onclick="execDaumPostcode()"></span><br/>
	                                <span class="address"><input type="text" class="adress_form_main" id="address" placeholder="주소입력"></span><br/>
	                                <span class="address"><input type="text" class="adress_form_main" id="detailAddress" placeholder="상세주소입력"></span>
	                            </div>
                                
                                <h3 class="section_addr">
                                    요청사항
                                </h3>
                                <div class="section_full">
	                                <span class="address"><input type="text" class="adress_form_main" id="request" placeholder="요청사항을 직접 입력합니다"></span>
                                	
                                </div>
                                
                            </div>

                            

                            <div class="tax_absolute">
                                <div class="inner_sticky" id="sticky" style="top:0px;">
                                    <h2 class="tit_section">결제금액</h2>
                                    <div id="orderitem_money_info">
                                        <dl class="amount fst">
                                            <dt class="tit">주문금액</dt>
                                            <dd class="price">
                                                <span id="productsTotalPrice" ></span> 
                                                원
                                            </dd>
                                        </dl>



                                        <dl class="amount">
                                            <dt class="tit">배송비</dt>
                                            <dd class="price delivery_area">
                                                <div id="paper_delivery_msg1" style="display: block;">
                                                    <span class="pm_sign" style="display: inline;">+</span>
                                                    <span id="paper_delivery" class=""></span>
                                                    원
                                                </div>
                                            </dd>
                                        </dl>

                                        <dl class="amount">
                                            <dt class="tit">포인트사용</dt>
                                            <dd class="price">
                                                <span class="num pay_sum" id="paper_reserves">0 원</span>
                                                <input type="hidden" class="emoney_point" value="">
                                            </dd>
                                        </dl>

                                        <dl class="amount lst">
                                            <dt class="tit">최종결제금액</dt>
                                            <dd class="price">
                                                <span id="paper_settlement"></span>
                                                <span class="won">원</span>
                                            </dd>
                                        </dl>


                                    </div>
                                </div>
                            </div>

                            <div class="data_payment">
                                <div class="tbl_left">
                                    <h2 class="tit_section">포인트</h2>

                                    <table class="goodsinfo_table">
                                        <tbody>
                                            <tr class="emoney_use">
                                                <th>
                                                    포인트 결제
                                                </th>

                                                <td>
                                                    <div id="ondealCheck">
                                                        <div class="emoney_reg">
                                                            <input type="text" name="using_point" id="emoney"  class="number_only" value="" placeholder="0" pattern="[0-9]*" inputmode="decimal">
                                                            <div class="check">
                                                                <label class="emoney_chkbox">
                                                                    <span class="txt_checkbox">모두사용</span>
                                                                </label>
                                                            </div>
                                                        </div>

                                                        <p class="possess">
                                                            보유 포인트 : <strong class="emph" th:text="${SiteUser.point}"></strong>원

                                                        </p>

                                                      
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="data_method">
                                <h2 class="tit_section" id="titFocusMethod">결제수단</h2>


                                <table class="goodsinfo_table tbl_left">
                                    <tbody>
                                        <tr>
                                            <th> 카카오페이 결제</th>
                                            <td>
                                                <label class="label_radio" id="cardBenefit_kakaopay">
                                                    <input type="radio" name="settlekind" value="kakaopay">
                                                    <span id="kakaopay">카카오페이</span>
                                                    
                                                    <div class="info_benefit"></div>
                                                </label>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="tit_section"> 
                                <input type="submit" value="결제하기" class="btn_payment">
                            </div>
                            
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>




<script>
    function execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var addr = ''; // 주소 변수
                var extraAddr = ''; // 참고항목 변수

                //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                    addr = data.roadAddress;
                } else { // 사용자가 지번 주소를 선택했을 경우(J)
                    addr = data.jibunAddress;
                }

                // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
                if(data.userSelectedType === 'R'){
                    // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                    // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                    if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                        extraAddr += data.bname;
                    }
                    // 건물명이 있고, 공동주택일 경우 추가한다.
                    if(data.buildingName !== '' && data.apartment === 'Y'){
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                    if(extraAddr !== ''){
                        extraAddr = ' (' + extraAddr + ')';
                        addr += ', ' + extraAddr
                    }
                    // 조합된 참고항목을 해당 필드에 넣는다.
                    
                
                } else {
                    
                }

                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                document.getElementById('postcode').value = data.zonecode;
                document.getElementById("address").value = addr;
                // 커서를 상세주소 필드로 이동한다.
                document.getElementById('postcode').disabled = true;
                document.getElementById('address').disabled = true;
                document.getElementById("detailAddress").focus();
            }
        }).open();
    }
</script>

</body>
</html>